import{u as e,e as t,f as s,g as l,o as a,c as r,w as i,a as n,J as c,B as u,F as o,C as d,T as p,b as g,t as v,d as f,i as m,I as y,P as h,Q as _,R as k,n as x,r as C,D as b,a5 as P,y as I,a6 as $,m as L,k as w,l as S,S as T,p as W,v as j,q as U,N}from"./index.88361eb6.js";import{_ as O}from"./_plugin-vue_export-helper.cdc0426e.js";import{_ as V}from"./toggle-spread-musicList.6161e08b.js";import"./u-icon.0263866c.js";import"./music-list-table.1b59f8b2.js";import"./u-line.c1c06170.js";const z=O({__name:"lyric-template",props:{lyricList:{type:Array},lyricVersion:{type:Number,default:0}},setup(h){const _=h,k=e(),x=t((()=>k.getters.setCurrentTime)),C=s(0);l(x,(e=>{e&&"00:00"!==e&&"00:01"!==e||(C.value=0),_.lyricList.forEach(((t,s)=>{t[0]===e&&(C.value=s)}))}),{immediate:!0});const b=s(0);l((()=>C.value),(e=>{const t=e-7>0?e-7:0;b.value=30*t}),{immediate:!0});return(e,t)=>{const s=f,l=m,_=y;return a(),r(l,{class:"lyric-container"},{default:i((()=>[n(l,{class:c([{empty:0===h.lyricList.length},"content"])},{default:i((()=>[h.lyricList.length>0?(a(),r(_,{key:0,"scroll-y":"true","scroll-top":b.value,"scroll-with-animation":"true"},{default:i((()=>[(a(!0),u(o,null,d(h.lyricList,((e,t)=>(a(),r(l,{key:t,class:c([{active:t===C.value},"lyric-text"])},{default:i((()=>[0===h.lyricVersion?(a(),r(s,{key:0,onClick:p((s=>((e,t)=>{const s=e[0].split(":"),l=60*parseInt(s[0])+parseInt(s[1]);C.value=t,k.commit("seekProgress",{s:l})})(e,t)),["stop"])},{default:i((()=>[g(v(e&&e[1]),1)])),_:2},1032,["onClick"])):(a(),r(l,{key:1},{default:i((()=>[g(v(e),1)])),_:2},1024))])),_:2},1032,["class"])))),128))])),_:1},8,["scroll-top"])):(a(),r(s,{key:1,class:"empty"},{default:i((()=>[g(" 暂无匹配歌词 ")])),_:1}))])),_:1},8,["class"])])),_:1})}}},[["__scopeId","data-v-47be9b70"]]);const R=O({name:"u-line-progress",mixins:[_,k,{props:{activeColor:{type:String,default:h.lineProgress.activeColor},inactiveColor:{type:String,default:h.lineProgress.color},percentage:{type:[String,Number],default:h.lineProgress.inactiveColor},showText:{type:Boolean,default:h.lineProgress.showText},height:{type:[String,Number],default:h.lineProgress.height}}}],data:()=>({lineWidth:0}),watch:{percentage(e){this.resizeProgressWidth()}},computed:{progressStyle(){let e={};return e.width=this.lineWidth,e.backgroundColor=this.activeColor,e.height=uni.$u.addUnit(this.height),e},innserPercentage(){return uni.$u.range(0,100,this.percentage)}},mounted(){this.init()},methods:{init(){uni.$u.sleep(20).then((()=>{this.resizeProgressWidth()}))},getProgressWidth(){return this.$uGetRect(".u-line-progress__background")},resizeProgressWidth(){this.getProgressWidth().then((e=>{const{width:t}=e;this.lineWidth=t*this.innserPercentage/100+"px"}))}}},[["render",function(e,t,s,l,c,u){const o=m,d=f;return a(),r(o,{class:"u-line-progress",style:x([e.$u.addStyle(e.customStyle)])},{default:i((()=>[n(o,{class:"u-line-progress__background",ref:"u-line-progress__background",style:x([{backgroundColor:e.inactiveColor,height:e.$u.addUnit(e.height)}])},null,8,["style"]),n(o,{class:"u-line-progress__line",style:x([u.progressStyle])},{default:i((()=>[C(e.$slots,"default",{},(()=>[e.showText&&e.percentage>=10?(a(),r(d,{key:0,class:"u-line-progress__text"},{default:i((()=>[g(v(u.innserPercentage+"%"),1)])),_:1})):b("",!0)]),!0)])),_:3},8,["style"])])),_:3},8,["style"])}],["__scopeId","data-v-50575cbb"]]),B=O({__name:"music-detail",setup(c){const p=s(null),y=e(),h=s(-30),_=s(0),k=t((()=>y.state.musicInfo)),C=t((()=>y.state.isPlay));l(C,(e=>{e?(h.value=10,p.value=setInterval((()=>{_.value+=.3}),10)):(h.value=-30,clearInterval(p.value))}),{immediate:!0});const O=t((()=>y.getters.setPrecentage)),B=s(),D=s(0);P((()=>{D.value=B.value.$el.offsetWidth}));const M=e=>{const t=e.detail.x-e.currentTarget.offsetLeft,s=Math.ceil(t/D.value*100);y.commit("seekProgress",{time:s})},q=s([]),A=s(0);s(0);const E=s(!1),F=s([]),G=s(!1),J=s(0),Q=(...e)=>{const t=q.value[A.value]||{};q.value[A.value]=Object.assign({},t,...e)},X=async(e,t)=>{const s=e||k.value.id;G.value=!0,F.value=[];const l=q.value[A.value],a=l&&l.lyricList||[];if(a.length>0)return F.value=a,void(G.value=!1);const{lrc:{lyric:r=""}={}}=await y.dispatch("getInfo",{path:`/lyric?id=${s}`});r?(r.indexOf("[")!==r.lastIndexOf("[")?(J.value=0,F.value=r.split(/\[/g).map((e=>{const t=e.split(/\..*\]/);if(t[0]&&t[1]&&"\n"!==t[1]&&-1===t[1].indexOf("："))return t[1]=t[1].replace("\n",""),t})).filter((e=>!!e))):(J.value=1,F.value=r.split("\n")),Q({lyricList:F.value}),G.value=!1):G.value=!1},H=e=>{if("play"===e||"pause"===e){const t="play"===e;y.commit("changePlayStatus",{isPlay:t})}else{const e=A.value;y.dispatch("getMusicInfo",{musicInfo:K.value[e],index:e}),_.value=0}};l(E,(e=>{if(e){const{id:e}=k.value;X(e)}})),l(k,(e=>{uni.$u.debounce((()=>{const{id:t,picUrl:s}=e;t&&(Q({picUrl:s}),E.value&&X(t))}),500)}),{immediate:!0,deep:!0});const K=t((()=>y.state.musicList));l(K,(e=>{q.value=e.map((e=>{const{name:t,_singer:s,id:l}=e;return{name:t,_singer:s,id:l}}))}),{immediate:!0,deep:!0});const Y=t((()=>y.getters.findCurrentPlayIndex()));l(Y,(e=>{A.value=e}),{immediate:!0});const Z=(e,t)=>{if(G.value)return;const{current:s}=e.detail;A.value=s;const l=K.value;(Y.value===s+1||s+1>l.length-1||Y.value===s-1||s-1<0)&&H()},ee=e=>{let t="next"===e?Y.value+1:Y.value-1;const s=K.value.length-1;t>s?t=0:t<0&&(t=s),A.value=t},te=s(0);return I((()=>{te.value=0,setTimeout((()=>{te.value="100%"}),500)})),$((()=>{clearInterval(p.value)})),(e,t)=>{const s=m,l=U,c=w(S("lyric-template"),z),p=N,y=T,k=w(S("u-line-progress"),R),P=f,I=w(S("toggle-spread-musicList"),V);return a(),r(s,{class:"container",style:x({height:te.value})},{default:i((()=>[q.value[A.value]?(a(),r(s,{key:0,class:"image-fill",style:x({backgroundImage:`url(${q.value[A.value].picUrl})`})},null,8,["style"])):b("",!0),n(y,{"scroll-x":"true",class:"swiper",onChange:Z,current:A.value,circular:""},{default:i((()=>[(a(!0),u(o,null,d(q.value,(e=>(a(),r(p,{class:"item",key:e.id},{default:i((()=>[n(s,{class:"music-info"},{default:i((()=>[n(s,{class:"name"},{default:i((()=>[g(v(e.name),1)])),_:2},1024),n(s,{class:"singer"},{default:i((()=>[g(v(e._singer),1)])),_:2},1024)])),_:2},1024),W(n(s,{class:"content",onClick:t[0]||(t[0]=e=>E.value=!0)},{default:i((()=>[n(s,{class:"needle",style:x({transform:`rotate(${h.value}deg) translateX(60rpx)`})},null,8,["style"]),n(s,{class:"disc"},{default:i((()=>[n(s,{class:"image",style:x({transform:`rotate(${_.value}deg)`})},{default:i((()=>[n(l,{src:e.picUrl,mode:""},null,8,["src"])])),_:2},1032,["style"])])),_:2},1024)])),_:2},1536),[[j,!E.value]]),W(n(s,{class:"lyric content",onClick:t[1]||(t[1]=e=>E.value=!1)},{default:i((()=>[n(c,{lyricList:F.value,lyricVersion:J.value},null,8,["lyricList","lyricVersion"])])),_:2},1536),[[j,e.lyricList]])])),_:2},1024)))),128))])),_:1},8,["current"]),n(s,{class:"controls"},{default:i((()=>[n(s,{class:"progress"},{default:i((()=>[n(s,{class:"current-time time"},{default:i((()=>[g(v(e.$store.getters.setCurrentTime),1)])),_:1}),n(s,{class:"progress-content",onClick:M,ref_key:"progressRef",ref:B},{default:i((()=>[n(k,{percentage:L(O),showText:!1,activeColor:"#aaa",height:"10rpx"},null,8,["percentage"]),n(s,{class:"dot",style:x({left:L(O)/100*D.value-6+"px"}),draggable:""},null,8,["style"])])),_:1},512),n(s,{class:"duration-time time"},{default:i((()=>[g(v(e.$store.getters.setDurationTime),1)])),_:1})])),_:1}),n(s,{class:"control-panel"},{default:i((()=>[n(s,{class:"loop"},{default:i((()=>[g("\\")])),_:1}),n(s,{class:"control-content"},{default:i((()=>[n(P,{class:"iconfont icon-prev",onClick:t[2]||(t[2]=e=>ee("prev"))}),n(s,{class:"play-pause"},{default:i((()=>[L(C)?(a(),r(P,{key:0,class:"iconfont icon-pause",onClick:t[3]||(t[3]=e=>H("pause"))})):(a(),r(P,{key:1,class:"iconfont icon-play",onClick:t[4]||(t[4]=e=>H("play"))}))])),_:1}),n(P,{class:"iconfont icon-next",onClick:t[5]||(t[5]=e=>ee("next"))})])),_:1}),n(s,{class:"list"},{default:i((()=>[n(I)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])}}},[["__scopeId","data-v-7959c2c5"]]);export{B as default};
